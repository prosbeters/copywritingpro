<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CopyGen Pro - Super Daging Edition</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0F0F12;
            color: white;
            margin: 0;
            overflow-x: hidden;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.02); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(99, 102, 241, 0.5); }

        @keyframes fade-in { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.4s ease-out forwards; }

        .glass-panel {
            background: rgba(24, 24, 27, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        .font-serif { font-family: 'Playfair+Display', serif; }

        .tooltip-box {
            visibility: hidden;
            opacity: 0;
            transform: translate(-50%, 10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .group-hover-tooltip:hover .tooltip-box {
            visibility: visible;
            opacity: 1;
            transform: translate(-50%, 0px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBk-_ZAPWkBLl1UvWD970ppG0ILj-uBCOo",
            authDomain: "copygenpro.firebaseapp.com",
            projectId: "copygenpro",
            storageBucket: "copygenpro.firebasestorage.app",
            messagingSenderId: "330336300596",
            appId: "1:330336300596:web:905b345eb47f210bd16461"
        };

        const app = initializeApp(firebaseConfig);
        window.FirebaseSDK = { 
            app, getAuth, signInWithEmailAndPassword, onAuthStateChanged, 
            signOut, getFirestore, doc, setDoc, onSnapshot 
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef, Fragment } = React;

        const APP_ID_INTERNAL = "copygenpro-final-v1";

        const Icon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                crown: <path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14" />,
                zap: <path d="M13 2 L3 14h9l-1 8 10-12h-9l1-8z" />,
                target: <Fragment><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></Fragment>,
                heart: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />,
                alert: <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3ZM12 9v4M12 17h.01" />,
                box: <Fragment><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></Fragment>,
                hand: <Fragment><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"/><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"/><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"/><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"/><path d="M14 11V9"/></Fragment>,
                info: <Fragment><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Fragment>,
                layers: <Fragment><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.1 6.8a2 2 0 0 0 0 3.6L11.17 15a2 2 0 0 0 1.66 0L21.9 10.4a2 2 0 0 0 0-3.6Z"/><path d="m2 14.6 10 5.2 10-5.2"/><path d="m2 18.6 10 5.2 10-5.2"/></Fragment>,
                lightbulb: <Fragment><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A5 5 0 0 0 8 8c0 1.3.5 2.6 1.5 3.5.8.8 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></Fragment>,
                download: <Fragment><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></Fragment>,
                logout: <Fragment><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></Fragment>,
                settings: <Fragment><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.72V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Fragment>,
                chevronDown: <path d="m6 9 6 6 6-6" />,
                x: <Fragment><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Fragment>,
                monitorOff: <Fragment><path d="M17 17H3a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2Z"/><path d="M1 7h22"/><path d="M9 22h6"/><path d="M12 17v5"/><path d="m2 2 20 20"/></Fragment>,
                copy: <Fragment><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></Fragment>,
                check: <polyline points="20 6 9 17 4 12"/>,
                loader: <Fragment><path d="M12 2v4"/><path d="m16.2 7.8 2.9-2.9"/><path d="M18 12h4"/><path d="m16.2 16.2 2.9 2.9"/><path d="M12 18v4"/><path d="m4.9 19.1 2.9-2.9"/><path d="M2 12h4"/><path d="m4.9 4.9 2.9 2.9"/></Fragment>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" />}
                </svg>
            );
        };

        const BackgroundEffects = () => (
            <div className="fixed inset-0 z-0 pointer-events-none overflow-hidden">
                <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-indigo-900/20 rounded-full blur-[120px] opacity-40 animate-pulse"></div>
                <div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-amber-900/10 rounded-full blur-[120px] opacity-40 animate-pulse" style={{animationDelay: '2s'}}></div>
                <div className="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"></div>
            </div>
        );

        const exampleOptions = {
            audience: ["Mahasiswa", "Pekerja Kantoran", "Ibu Rumah Tangga", "Pengusaha UMKM", "Freelancer"],
            tone: ["Santai & Friendly", "Formal & Profesional", "Mendesak (FOMO)", "Storytelling Emosional", "Lucu & Jenaka"],
            platform: ["Instagram Caption", "Facebook Ads", "LinkedIn Post", "WhatsApp Blast", "TikTok Script"]
        };

        const formulas = [
            { id: 'acc', name: 'ACC', fullName: 'Awareness, Comprehension, Conversion', icon: 'target', desc: 'Edukasi pasar baru.', strategyInfo: 'Membangun kesadaran merek, pemahaman mendalam, dan memicu konversi pembelian.' },
            { id: '4cs', name: '4Cs', fullName: 'Clear, Concise, Compelling, Credible', icon: 'check', desc: 'To-the-point & Kredibel.', strategyInfo: 'Menyampaikan pesan jernih, ringkas, menarik, dan didukung bukti terpercaya.' },
            { id: 'aida', name: 'AIDA', fullName: 'Attention, Interest, Desire, Action', icon: 'heart', desc: 'Psikologi klasik.', strategyInfo: 'Menarik perhatian, memicu minat, hasrat, dan akhirnya tindakan beli.' },
            { id: 'pas', name: 'PAS', fullName: 'Problem, Agitate, Solution', icon: 'alert', desc: 'Mainkan rasa sakit.', strategyInfo: 'Menyorot penderitaan audiens, mempertajam efeknya, lalu menawarkan solusi.' },
            { id: 'fab', name: 'FAB', fullName: 'Features, Advantage, Benefits', icon: 'box', desc: 'Fokus ke untung.', strategyInfo: 'Mengubah spesifikasi teknis menjadi keunggulan dan manfaat nyata konsumen.' },
            { id: 'slap', name: 'SLAP', fullName: 'Stop, Look, Act, Purchase', icon: 'hand', desc: 'Agresif & Cepat.', strategyInfo: 'Taktik menghentikan scroll dan memaksa audiens bertindak seketika.' }
        ];

        const FormInput = ({ label, name, value, onChange, placeholder, isTextArea = false, examples = [], className = "", info = "" }) => {
            const [showDropdown, setShowDropdown] = useState(false);
            const wrapperRef = useRef(null);
            useEffect(() => {
                const handleClickOutside = (e) => { if (wrapperRef.current && !wrapperRef.current.contains(e.target)) setShowDropdown(false); };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            return (
                <div className={`group animate-fade-in ${className}`} ref={wrapperRef} style={{ zIndex: showDropdown ? 60 : "auto", position: "relative" }}>
                    <div className="flex items-center gap-1.5 mb-1.5 group-focus-within:text-indigo-400 transition-colors">
                        <label className="block text-[10px] font-bold text-gray-500 uppercase tracking-widest">{label}</label>
                        {info && (
                            <div className="relative group/tooltip group-hover-tooltip cursor-help">
                                <Icon name="info" className="w-3 h-3 text-gray-700 hover:text-indigo-500 transition-colors" />
                                <div className="tooltip-box absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-56 p-3 bg-[#1E1E21] border border-white/10 rounded-xl shadow-2xl z-[100] backdrop-blur-xl pointer-events-none">
                                    <p className="text-[10px] text-gray-300 leading-relaxed font-light">{info}</p>
                                </div>
                            </div>
                        )}
                    </div>
                    <div className="relative">
                        {isTextArea ? (
                            <textarea name={name} value={value} onChange={onChange} placeholder={placeholder} className="w-full bg-black/40 border border-white/10 rounded-xl py-3 px-4 text-sm text-white focus:border-indigo-500 outline-none h-28 resize-none transition-all scrollbar-thin" />
                        ) : (
                            <input type="text" name={name} value={value} onChange={onChange} onFocus={() => examples?.length > 0 && setShowDropdown(true)} placeholder={placeholder} autoComplete="off" className="w-full bg-black/40 border border-white/10 rounded-xl py-3.5 px-4 pr-10 text-sm text-white focus:border-indigo-500 outline-none transition-all" />
                        )}
                        {examples?.length > 0 && (
                            <div className="absolute right-3 top-3.5 text-gray-500 cursor-pointer hover:text-indigo-400 p-1" onClick={() => setShowDropdown(!showDropdown)}><Icon name="chevronDown" className={`w-4 h-4 transition-transform ${showDropdown ? 'rotate-180' : ''}`} /></div>
                        )}
                        {showDropdown && (
                            <div className="absolute z-[70] w-full mt-2 bg-[#1E1E21] border border-white/20 rounded-xl shadow-2xl overflow-hidden animate-fade-in origin-top">
                                <div className="px-4 py-2 bg-white/5 border-b border-white/10 flex justify-between items-center backdrop-blur-md text-[10px] font-bold text-indigo-400 uppercase">Pilih Cepat</div>
                                <div className="max-h-52 overflow-y-auto custom-scrollbar p-1">
                                    {examples.map((ex, i) => (
                                        <button key={i} type="button" onClick={() => { onChange({ target: { name, value: ex } }); setShowDropdown(false); }} className="w-full text-left text-xs text-gray-300 hover:bg-indigo-600 p-3 rounded-lg flex items-center gap-2 transition-colors"><div className="w-1 h-1 rounded-full bg-indigo-500" />{ex}</button>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const LoginPage = () => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const login = async (e) => {
                e.preventDefault(); 
                if (!window.FirebaseSDK) return;
                setLoading(true); setError('');
                const { getAuth, signInWithEmailAndPassword, getFirestore, doc, setDoc } = window.FirebaseSDK;
                const auth = getAuth();
                const db = getFirestore();
                try {
                    const cred = await signInWithEmailAndPassword(auth, email, password);
                    const sid = crypto.randomUUID();
                    localStorage.setItem('copygen_session_id', sid);
                    await setDoc(doc(db, 'artifacts', APP_ID_INTERNAL, 'users', cred.user.uid, 'session', 'current'), { sessionId: sid, lastActive: Date.now() });
                } catch (e) { setError('Akses ditolak. Cek email/password Anda.'); } finally { setLoading(false); }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4 relative overflow-hidden bg-[#0F0F12]">
                    <BackgroundEffects />
                    <div className="relative z-10 w-full max-w-md glass-panel rounded-3xl p-8 md:p-12 text-center shadow-2xl text-white">
                        <div className="mb-6"><Icon name="crown" className="w-12 h-12 text-indigo-400 mx-auto shadow-indigo-500/50 shadow-2xl" /></div>
                        <h1 className="text-3xl font-bold mb-2 tracking-tight text-white font-serif italic">CopyGen Pro</h1>
                        <p className="text-xs text-gray-400 italic mb-10 leading-relaxed text-white">"Mempermudah pekerjaan Anda, Smart, Fokus, dan Efisien"</p>
                        <form onSubmit={login} className="space-y-6 text-left">
                            <div><label className="text-[10px] font-bold text-gray-500 uppercase tracking-widest ml-1 text-white">Email ID</label><input type="email" value={email} onChange={e=>setEmail(e.target.value)} className="w-full bg-black/20 border border-white/10 rounded-xl p-4 text-sm outline-none focus:ring-1 focus:ring-indigo-500 transition-all text-white" required placeholder="name@company.com" /></div>
                            <div><label className="text-[10px] font-bold text-gray-500 uppercase tracking-widest ml-1 text-white">Password</label><input type="password" value={password} onChange={e=>setPassword(e.target.value)} className="w-full bg-black/20 border border-white/10 rounded-xl p-4 text-sm outline-none focus:ring-1 focus:ring-indigo-500 transition-all text-white" required placeholder="••••••••" /></div>
                            {error && <div className="p-3 bg-red-500/10 border border-red-500/20 rounded-lg flex items-center gap-2 text-red-400 text-[11px] animate-fade-in"><span>{error}</span></div>}
                            <button type="submit" disabled={loading} className="w-full bg-indigo-600 hover:bg-indigo-500 text-white p-4 rounded-xl font-bold uppercase text-sm tracking-widest transition-all shadow-lg active:scale-95">{loading ? 'Memverifikasi...' : 'Masuk ke Sistem'}</button>
                        </form>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [apiKey, setApiKey] = useState('');
            const [conflict, setConflict] = useState(false);
            const [formData, setFormData] = useState({ productName: '', audience: '', tone: '', platform: '', problem: '', solution: '', offer: '' });
            const [selectedFormula, setSelectedFormula] = useState(null);
            const [results, setResults] = useState([]);
            const [isGenerating, setIsGenerating] = useState(false);
            const [copiedIdx, setCopiedIdx] = useState(null);
            const [keyInput, setKeyInput] = useState('');
            const [isValidating, setIsValidating] = useState(false);
            const [apiError, setApiError] = useState('');

            useEffect(() => {
                const interval = setInterval(() => {
                    if (window.FirebaseSDK) {
                        clearInterval(interval);
                        const { getAuth, onAuthStateChanged, getFirestore, doc, onSnapshot } = window.FirebaseSDK;
                        const auth = getAuth();
                        const db = getFirestore();
                        onAuthStateChanged(auth, u => {
                            setUser(u); setLoading(false);
                            if (u) {
                                onSnapshot(doc(db, 'artifacts', APP_ID_INTERNAL, 'users', u.uid, 'session', 'current'), snap => {
                                    if (snap.exists() && snap.data().sessionId !== localStorage.getItem('copygen_session_id')) setConflict(true);
                                });
                            }
                        });
                        setApiKey(localStorage.getItem('copygen_gemini_key') || '');
                    }
                }, 100);
                return () => clearInterval(interval);
            }, []);

            const updateKey = async () => {
                const cleaned = keyInput.trim();
                if (!cleaned) return;
                setIsValidating(true); setApiError('');
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${cleaned}`, {
                        method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({contents: [{parts:[{text: "Ping"}]}]})
                    });
                    if (!res.ok) throw new Error('API Key tidak valid.');
                    setApiKey(cleaned);
                    localStorage.setItem('copygen_gemini_key', cleaned);
                    setKeyInput('');
                } catch (e) { setApiError(e.message); } finally { setIsValidating(false); }
            };

            const logout = () => { 
                if (!window.FirebaseSDK) return;
                const { getAuth, signOut } = window.FirebaseSDK;
                signOut(getAuth()); 
                localStorage.removeItem('copygen_session_id'); 
                setConflict(false); setUser(null);
            };
            
            const handleInputChange = e => {
                const { name, value } = e.target;
                setFormData(prev => ({...prev, [name]: value}));
            };

            const generate = async () => {
                if (!apiKey || !selectedFormula) return;
                setIsGenerating(true);
                try {
                    const formulaObj = formulas.find(f => f.id === selectedFormula);
                    
                    // --- SUNTIKAN PENGETAHUAN PRODUK (INTERNAL PROMPT) ---
                    const prompt = `
                        Role: Pakar Conversion Copywriter Berbasis Data & Otoritas.
                        
                        Instruksi Utama:
                        Anda WAJIB menyebutkan nama brand/produk "${formData.productName}" secara eksplisit.
                        
                        SUNTIKAN PENGETAHUAN:
                        Manfaatkan basis pengetahuan luas Anda tentang kategori produk "${formData.productName}".
                        Jika produk mengandung bahan spesifik (misal: Robusta Coffee, Niacinamide, Carbon Fiber, dsb), gunakan data teknis/fakta ilmiah/karakteristik asli bahan tersebut untuk memperkuat copywriting.
                        Contoh: Jika Robusta, bahas kadar kafein yang tinggi atau rasa bold-nya. Jika Niacinamide, bahas cara kerjanya di sel kulit.
                        
                        Formula: ${formulaObj.fullName} (${formulaObj.desc}).
                        
                        Data Input Pengguna:
                        - Nama Produk: ${formData.productName}
                        - Audiens: ${formData.audience}
                        - Tone: ${formData.tone}
                        - Platform: ${formData.platform}
                        - Masalah (Pain): ${formData.problem}
                        - Solusi (Gain): ${formData.solution}
                        - Penawaran: ${formData.offer}
                        
                        Hasilkan 15 variasi copywriting "Super Daging" dalam Bahasa Indonesia yang berwibawa, emosional, dan berbasis fakta produk.
                        Sertakan Smart Analysis psikologis singkat untuk setiap variasi.
                        
                        Format Output WAJIB JSON array: [{"text": "...", "analysis": "..."}]
                    `;

                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({contents: [{parts:[{text: prompt}]}], generationConfig:{responseMimeType: "application/json"}})
                    });
                    const data = await res.json();
                    setResults(JSON.parse(data.candidates[0].content.parts[0].text));
                } catch(e) { console.error(e); } finally { setIsGenerating(false); }
            };

            const handleCopy = (text, i) => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopiedIdx(i);
                    setTimeout(() => setCopiedIdx(null), 2000);
                } catch (err) { console.error('Gagal menyalin teks', err); }
                document.body.removeChild(textArea);
            };

            const downloadWord = () => {
                const content = `<html><body><h2>CopyGen Pro Result</h2>${results.map((item, i)=>`<div><h3>Varian #${i+1}</h3><p>${String(item.text)}</p><p><i>Analisis: ${String(item.analysis)}</i></p></div>`).join('')}</body></html>`;
                const blob = new Blob(['\ufeff', content], { type: 'application/msword' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a'); 
                link.href = url; link.download = `CopyGen_Result_${formData.productName || 'Export'}.doc`; link.click();
            };

            if (loading) return <div className="min-h-screen bg-[#0F0F12] flex items-center justify-center text-white uppercase tracking-widest text-xs">Initializing...</div>;
            if (!user) return <LoginPage />;
            if (conflict) return (
                <div className="min-h-screen bg-[#0F0F12] flex items-center justify-center p-6 text-center text-white">
                    <BackgroundEffects />
                    <div className="glass-panel p-10 rounded-3xl max-w-sm border-red-500/20 shadow-2xl relative z-10 animate-fade-in text-white">
                        <Icon name="monitorOff" className="w-14 h-14 text-red-500 mx-auto mb-6" />
                        <h2 className="text-2xl font-bold mb-4 uppercase">Sesi Terputus</h2>
                        <p className="text-gray-400 mb-8 leading-relaxed text-sm">Akun ini aktif di perangkat lain. 1 ID hanya untuk 1 perangkat aktif.</p>
                        <button onClick={logout} className="w-full bg-red-600 hover:bg-red-500 p-3 rounded-xl font-bold uppercase text-xs transition-all">Kembali ke Login</button>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen relative overflow-x-hidden bg-[#0F0F12] text-white">
                    <BackgroundEffects />
                    <nav className="sticky top-0 z-50 glass-panel border-b border-white/5 px-6 py-4 backdrop-blur-xl flex justify-between items-center">
                        <div className="flex items-center gap-4">
                            <Icon name="crown" className="text-indigo-400 w-6 h-6" />
                            <div><h1 className="text-xl font-bold tracking-tight font-serif italic text-white">CopyGen Pro</h1><p className="text-[9px] text-gray-500 hidden sm:block uppercase tracking-wider text-white">Mempermudah pekerjaan Anda, Smart, Fokus, Efisien</p></div>
                        </div>
                        <button onClick={logout} className="text-[10px] font-bold text-gray-400 flex items-center gap-2 hover:text-white transition-colors bg-white/5 px-4 py-2 rounded-lg uppercase tracking-widest border border-white/5"><Icon name="logout" className="w-3.5 h-3.5" /> Log Out</button>
                    </nav>

                    <main className="relative z-10 max-w-7xl mx-auto p-4 md:p-8 pt-10 grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div className="lg:col-span-5 space-y-6">
                            <div className="glass-panel rounded-2xl p-5 border border-white/10">
                                {!apiKey ? (
                                    <div className="space-y-4">
                                        <h3 className="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">Aktivasi AI Engine</h3>
                                        <input type="password" value={keyInput} onChange={(e) => setKeyInput(e.target.value)} placeholder="Masukkan Gemini API Key..." className="w-full bg-black/40 border border-white/10 rounded-xl p-3 text-xs outline-none focus:border-indigo-500" />
                                        <button onClick={updateKey} disabled={isValidating} className="w-full bg-indigo-600 hover:bg-indigo-500 text-white p-2.5 rounded-lg text-[10px] font-bold uppercase tracking-widest">{isValidating ? 'Menghubungkan...' : 'Aktifkan Mesin'}</button>
                                    </div>
                                ) : (
                                    <div className="flex justify-between items-center">
                                        <div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div><span className="text-[10px] font-bold text-emerald-400 uppercase tracking-widest">AI Engine Active</span></div>
                                        <button onClick={() => {setApiKey(''); localStorage.removeItem('copygen_gemini_key');}} className="text-[9px] text-red-400 uppercase font-bold hover:underline">Ganti Key</button>
                                    </div>
                                )}
                            </div>

                            <div className="glass-panel rounded-2xl p-6 border border-white/10 space-y-6">
                                <div>
                                    <h2 className="text-[10px] font-bold text-gray-400 uppercase tracking-[0.2em] mb-4 flex items-center gap-2 font-serif italic"><Icon name="layers" className="w-4 h-4 text-indigo-400" /> Tahap 1: Strategi</h2>
                                    <div className="grid grid-cols-3 gap-2">
                                        {formulas.map(f => (
                                            <button key={f.id} onClick={()=>setSelectedFormula(f.id)} className={`p-3 rounded-xl border text-center transition-all relative group/formula ${selectedFormula === f.id ? 'bg-indigo-600/20 border-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.2)]' : 'bg-white/5 border-transparent hover:border-white/10'}`}>
                                                <div className="absolute top-1 right-1 group-hover-tooltip group/info">
                                                    <Icon name="info" className="w-3 h-3 text-gray-700 hover:text-indigo-400 transition-colors cursor-help" />
                                                    <div className="tooltip-box absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2.5 bg-[#1E1E21] border border-white/10 rounded-lg shadow-2xl z-[100] backdrop-blur-xl pointer-events-none">
                                                        <p className="text-[9px] text-indigo-400 font-bold uppercase mb-1">{f.fullName}</p>
                                                        <p className="text-[10px] text-gray-300 leading-relaxed font-light">{f.strategyInfo}</p>
                                                    </div>
                                                </div>
                                                <Icon name={f.icon} className={`mx-auto mb-1.5 ${selectedFormula === f.id ? 'text-white' : 'text-gray-500'}`} />
                                                <span className={`text-[10px] font-bold block ${selectedFormula === f.id ? 'text-white' : 'text-gray-400'}`}>{f.name}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div className="space-y-4 pt-4 border-t border-white/5">
                                    <h2 className="text-[10px] font-bold text-gray-400 uppercase tracking-[0.2em] mb-4 flex items-center gap-2 font-serif italic"><Icon name="box" className="w-4 h-4 text-indigo-400" /> Tahap 2: Input Penting</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <FormInput label="Nama Produk" name="productName" value={formData.productName} onChange={handleInputChange} placeholder="Contoh: Kopi Robusta Lampung" className="md:col-span-2" info="Tuliskan nama produk atau brand dengan jelas agar AI bisa mengenali karakteristik dasarnya." />
                                        <FormInput label="Target Audiens" name="audience" value={formData.audience} onChange={handleInputChange} placeholder="Pekerja Kantoran" examples={exampleOptions.audience} info="Semakin spesifik target Anda, semakin tajam argumen psikologis yang diberikan AI." />
                                        <FormInput label="Gaya Bahasa" name="tone" value={formData.tone} onChange={handleInputChange} placeholder="Santai" examples={exampleOptions.tone} info="Pilih nuansa tulisan yang paling mencerminkan kepribadian brand Anda." />
                                        <div className="md:col-span-2"><FormInput label="Platform / Media" name="platform" value={formData.platform} onChange={handleInputChange} placeholder="Instagram Ads" examples={exampleOptions.platform} info="Media tayang sangat menentukan format tulisan (panjang/pendek/hasthtag)." /></div>
                                        <div className="md:col-span-2"><FormInput label="Masalah (Pain)" name="problem" value={formData.problem} onChange={handleInputChange} isTextArea placeholder="Apa keresahan audiens Anda?" info="Jelaskan titik sakit emosional yang dirasakan audiens Anda saat ini." /></div>
                                        <div className="md:col-span-2"><FormInput label="Solusi (Gain)" name="solution" value={formData.solution} onChange={handleInputChange} isTextArea placeholder="Bagaimana produk ini menyembuhkan masalah di atas?" info="Tuliskan manfaat utama. AI akan menghubungkannya dengan fakta teknis produk." /></div>
                                        <div className="md:col-span-2"><FormInput label="Penawaran & Bukti" name="offer" value={formData.offer} onChange={handleInputChange} isTextArea placeholder="Promo? Testimoni? Alasan beli sekarang?" info="Bagian untuk meyakinkan pembeli dengan bukti dan urgensi." /></div>
                                    </div>
                                    <button onClick={generate} disabled={!selectedFormula || isGenerating || !apiKey} className={`w-full py-4 rounded-xl font-bold mt-4 shadow-xl uppercase text-[10px] tracking-[0.3em] transition-all flex items-center justify-center gap-3 ${!selectedFormula || !apiKey ? 'bg-gray-800 text-gray-500 opacity-50 cursor-not-allowed' : 'bg-indigo-600 hover:bg-indigo-500 text-white active:scale-95'}`}>
                                        {isGenerating ? <Icon name="loader" className="animate-spin w-4 h-4" /> : <Icon name="zap" className="w-4 h-4" />}
                                        {isGenerating ? 'Menganalisis Daging...' : 'Hasilkan Copywriting Premium'}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div className="lg:col-span-7">
                            <div className="glass-panel rounded-2xl flex flex-col min-h-[700px] overflow-hidden border border-white/5">
                                <div className="p-8 border-b border-white/5 flex justify-between items-center bg-white/5">
                                    <div className="flex items-center gap-4"><Icon name="zap" className="text-indigo-400 w-5 h-5" /><div><h2 className="text-xl font-bold text-white font-serif italic">Arsip Hasil Generate</h2><p className="text-[10px] text-gray-500 uppercase tracking-widest font-medium">15 Variasi AI Masterpiece</p></div></div>
                                    {results.length > 0 && <button onClick={downloadWord} className="bg-white/5 border border-white/10 px-5 py-2.5 rounded-xl text-[10px] font-bold flex items-center gap-2 uppercase transition-all hover:bg-white/10 text-white tracking-widest"><Icon name="download" className="w-3.5 h-3.5" /> Save (.doc)</button>}
                                </div>
                                <div className="p-8 space-y-8 overflow-y-auto custom-scrollbar flex-grow bg-gradient-to-b from-white/5 to-transparent">
                                    {results.length === 0 ? (
                                        <div className="h-full flex flex-col items-center justify-center py-40 opacity-20 grayscale text-center space-y-6">
                                            <Icon name="box" className="w-32 h-32 text-white" />
                                            <p className="max-w-xs text-sm font-medium text-white tracking-widest uppercase text-center">Pilih strategi & isi data di kiri</p>
                                        </div>
                                    ) : (
                                        results.map((item, i) => (
                                            <div key={i} className="group glass-panel rounded-2xl p-8 hover:border-indigo-500/40 transition-all duration-500 animate-fade-in relative overflow-hidden text-white border border-white/5 shadow-inner">
                                                <div className="absolute top-0 right-0 p-10 opacity-5 pointer-events-none group-hover:opacity-10 transition-opacity"><Icon name="zap" className="w-20 h-20" /></div>
                                                <div className="absolute top-6 right-8 text-[9px] font-bold text-gray-600 uppercase tracking-widest bg-white/5 px-3 py-1 rounded-full border border-white/5">Option {i+1}</div>
                                                <p className="text-gray-200 text-lg leading-relaxed mb-8 font-light pr-10 whitespace-pre-wrap">{String(item.text)}</p>
                                                <div className="bg-black/40 rounded-2xl p-5 border border-white/10 relative text-white">
                                                    <div className="absolute -top-3 left-6 bg-[#0F0F12] px-3 py-1 rounded-full border border-white/10 flex items-center gap-2 text-white"><Icon name="lightbulb" className="w-3 h-3 text-amber-500" /><span className="text-[9px] text-amber-500 font-bold uppercase tracking-widest">Smart Analysis</span></div>
                                                    <p className="text-gray-400 text-xs text-justify font-light leading-relaxed text-white">{String(item.analysis)}</p>
                                                </div>
                                                <div className="mt-8 flex justify-end opacity-0 group-hover:opacity-100 transition-all text-white">
                                                    <button 
                                                        onClick={() => handleCopy(String(item.text), i)} 
                                                        className={`text-[10px] font-bold flex items-center gap-2 px-6 py-2.5 rounded-xl shadow-md uppercase tracking-widest transition-all ${copiedIdx === i ? 'bg-emerald-500 text-white border-emerald-500' : 'bg-indigo-600 text-white hover:bg-indigo-500 border border-white/5'}`}
                                                    >
                                                        {copiedIdx === i ? <Fragment><Icon name="check" className="w-3 h-3" /> Copied!</Fragment> : <Fragment><Icon name="copy" className="w-3 h-3" /> Salin Teks</Fragment>}
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        </script>
    </body>
    </html>
